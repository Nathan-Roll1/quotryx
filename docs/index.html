<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>quotryx</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            mono: ['JetBrains Mono', 'monospace'],
          }
        }
      }
    }
  </script>
  <style>
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    input[type="number"] { -moz-appearance: textfield; }
    input[type="radio"]:checked + label { background: #111; color: #fff; }
  </style>
</head>
<body class="bg-stone-50 text-neutral-900 font-sans antialiased min-h-screen lowercase">

  <div class="max-w-xl mx-auto px-5 py-8">

    <header class="flex items-center justify-between mb-8 border-b border-neutral-200 pb-4">
      <div class="flex items-center gap-2">
        <svg class="w-5 h-5 text-neutral-900" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round">
          <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
        </svg>
        <h1 class="text-lg font-semibold tracking-tight">quotryx</h1>
      </div>
      <span id="stats" class="text-xs text-neutral-400 font-mono tabular-nums"></span>
    </header>

    <div id="result" class="mb-8 hidden">
      <div class="text-xs text-neutral-400 tracking-widest mb-1">estimate</div>
      <div id="price" class="text-4xl font-semibold font-mono tabular-nums tracking-tight"></div>
      <div id="context" class="mt-1.5 text-sm text-neutral-500 font-mono tabular-nums"></div>
    </div>

    <div>

      <fieldset class="mb-6">
        <div class="flex rounded border border-neutral-300 overflow-hidden text-sm" role="radiogroup">
          <input type="radio" name="city" value="Saskatoon" id="city_1" class="sr-only peer" checked>
          <label for="city_1" class="flex-1 text-center py-2 cursor-pointer transition-colors bg-white text-neutral-600 hover:bg-neutral-50 border-r border-neutral-300 font-medium select-none">Saskatoon</label>
          <input type="radio" name="city" value="Regina" id="city_2" class="sr-only peer">
          <label for="city_2" class="flex-1 text-center py-2 cursor-pointer transition-colors bg-white text-neutral-600 hover:bg-neutral-50 border-r border-neutral-300 font-medium select-none">Regina</label>
          <input type="radio" name="city" value="Prince Albert" id="city_3" class="sr-only peer">
          <label for="city_3" class="flex-1 text-center py-2 cursor-pointer transition-colors bg-white text-neutral-600 hover:bg-neutral-50 font-medium select-none">Prince Albert</label>
        </div>
      </fieldset>

      <fieldset class="mb-5">
        <div class="grid grid-cols-3 gap-3" id="numeric-fields"></div>
      </fieldset>

      <fieldset class="mb-6">
        <div class="grid grid-cols-3 gap-y-2 gap-x-4" id="flag-fields"></div>
      </fieldset>

    </div>

    <footer class="mt-6 text-[11px] text-neutral-300 text-right">
      degree-2 OLS &middot; blank = mean
    </footer>

  </div>

<script>
const M = {"intercept": -4557013.33018273, "coefficients": [-29466.971991350343, -23037.8122805374, 311.232330768883, 8340.7452634088, 2119.3143594138364, -1045.58101702588, -124514.48256977178, -340150.8014295176, -28076.08830154168, -54927.107079700356, 55705.131404585416, -21515.069499508634, 435215.8772680179, 313096.29156979336], "powers": [[1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]], "feature_means": {"bedrooms": 3.0, "bathrooms": 2.0, "size_interior_sqft": 1199.0, "lot_size_percentile": 50.05959475566151, "year_built": 1989.0, "parking_spaces": 2.0, "lot_size_sqft": 4784.0}, "lot_sqfts_sorted": [1.0, 1.0, 1.0, 109.71, 283.0, 990.0, 1184.0, 1595.0, 1737.3600000000001, 1750.0, 1795.0, 1798.0, 1998.0, 2067.0, 2071.0, 2092.0, 2092.0, 2093.0, 2100.0, 2128.0, 2129.6, 2129.6, 2129.6, 2166.0, 2193.0, 2193.0, 2243.0, 2248.0, 2260.0, 2260.0, 2274.0, 2280.0, 2340.0, 2360.0, 2405.0, 2491.0, 2492.0, 2492.0, 2492.0, 2492.0, 2492.0, 2492.0, 2508.0, 2519.0, 2519.0, 2519.0, 2632.9, 2680.0, 2712.0, 2712.0, 2755.0, 2799.0, 2808.0, 2828.0, 2833.0, 2833.0, 2833.0, 2870.0, 2875.0, 2895.0, 2904.0, 2912.0, 2912.0, 2912.0, 2917.0, 2929.0, 2956.2000000000003, 2979.0, 2979.0, 2997.0, 3000.0, 3000.0, 3000.0, 3011.0, 3011.0, 3011.0, 3013.0, 3013.0, 3023.0, 3027.0, 3036.0, 3057.88, 3087.6, 3088.0, 3095.0, 3102.0, 3108.0, 3109.0, 3111.0, 3113.7900000000004, 3114.0, 3116.7, 3117.0, 3118.0, 3119.0, 3119.0, 3119.0, 3119.0, 3119.0, 3119.0, 3119.0, 3120.0, 3120.0, 3120.0, 3120.0, 3120.0, 3121.0, 3121.0, 3121.0, 3121.0, 3122.0, 3122.0, 3122.0, 3122.0, 3122.0, 3122.0, 3122.0, 3123.0, 3123.0, 3123.0, 3123.0, 3123.0, 3123.0, 3123.0, 3123.0, 3124.0, 3124.0, 3124.0, 3124.0, 3124.0, 3124.0, 3124.0, 3124.0, 3124.0, 3125.0, 3125.0, 3125.0, 3125.0, 3125.0, 3125.0, 3125.0, 3125.0, 3125.0, 3125.0, 3125.0, 3125.0, 3125.0, 3125.0, 3125.0, 3125.0, 3125.0, 3126.0, 3126.0, 3126.0, 3126.0, 3126.0, 3126.0, 3126.0, 3126.0, 3127.0, 3127.0, 3128.0, 3129.0, 3129.0, 3130.0, 3130.0, 3130.0, 3130.0, 3131.0, 3132.0, 3134.0, 3150.0, 3150.0, 3172.2, 3172.2, 3172.2, 3175.0, 3192.0, 3192.0, 3192.0, 3192.0, 3192.0, 3220.0, 3245.0, 3251.0, 3255.93, 3255.93, 3256.0, 3265.0, 3270.0, 3275.0, 3276.0, 3280.0, 3283.0, 3297.0, 3297.0, 3300.0, 3311.0, 3314.0, 3316.72, 3325.0, 3359.0, 3367.0, 3369.0, 3371.0, 3372.0, 3374.0, 3375.0, 3376.0, 3376.0, 3376.0, 3377.0, 3397.0, 3400.18, 3406.0, 3411.0, 3411.0, 3420.0, 3423.0, 3429.0, 3437.56, 3451.62, 3462.0, 3477.75, 3477.75, 3484.0, 3484.8, 3495.0, 3495.0000000000005, 3499.0, 3500.0, 3500.0, 3500.0, 3503.0, 3525.0, 3545.0, 3550.72, 3560.0, 3560.0, 3585.0, 3594.88, 3596.0, 3600.0, 3600.0, 3620.0, 3622.0, 3627.0, 3638.0, 3640.0, 3648.0, 3648.0, 3648.0, 3651.2, 3651.2, 3662.0, 3675.0, 3685.0, 3686.0, 3693.0, 3697.0, 3704.0, 3738.0, 3747.0, 3750.0, 3751.0, 3755.0, 3756.0, 3763.1000000000004, 3763.1000000000004, 3763.1000000000004, 3763.1000000000004, 3776.0, 3776.0, 3776.71, 3776.71, 3777.0, 3782.0, 3795.0, 3799.0, 3812.1000000000004, 3837.0, 3837.0, 3838.5, 3838.5, 3840.0, 3840.0, 3840.0, 3876.0, 3876.0, 3891.0, 3894.0, 3896.0, 3900.0, 3900.0, 3903.8, 3920.0, 3920.3999999999996, 3935.0, 3935.0, 3936.0, 3961.0, 3967.2, 3977.0, 3989.0, 3990.0, 3990.0, 3990.0, 3990.0, 4001.4, 4004.0, 4004.91, 4004.91, 4004.91, 4004.91, 4012.0, 4014.0, 4014.0, 4017.0, 4018.0, 4025.0, 4026.0, 4026.0, 4033.29, 4039.0, 4064.0, 4068.0, 4104.0, 4108.0, 4118.0, 4121.0, 4122.84, 4125.0, 4125.0, 4128.0, 4145.0, 4148.0, 4153.0, 4167.0, 4168.0, 4198.0, 4200.0, 4201.0, 4202.0, 4235.0, 4235.0, 4236.8, 4248.0, 4267.0, 4271.0, 4272.0, 4281.0, 4284.25, 4290.0, 4316.81, 4320.0, 4337.0, 4340.0, 4340.0, 4356.0, 4356.0, 4360.0, 4373.0, 4374.0, 4375.0, 4384.0, 4386.0, 4389.0, 4390.0, 4393.0, 4400.0, 4400.0, 4405.941000000001, 4405.941000000001, 4428.0, 4438.0, 4440.0, 4457.0, 4462.37, 4483.0, 4486.0, 4500.0, 4509.0, 4518.0, 4521.0, 4525.0, 4539.14, 4544.0, 4562.0, 4576.0, 4585.148, 4590.0, 4596.0, 4599.0, 4600.0, 4610.0, 4618.0, 4630.1, 4652.0, 4668.75, 4670.0, 4680.0, 4685.0, 4686.0, 4687.0, 4688.0, 4689.0, 4690.0, 4691.0, 4694.0, 4696.0, 4704.0, 4710.0, 4720.0, 4735.0, 4738.0, 4751.0, 4762.5, 4770.0, 4778.0, 4784.0, 4790.0, 4791.6, 4791.6, 4793.0, 4800.0, 4810.0, 4810.0, 4838.0, 4839.0, 4876.88, 4878.0, 4900.0, 4902.0, 4913.0, 4942.0, 4944.0, 4945.0, 4952.1900000000005, 4991.0, 4998.0, 4998.0, 4999.0, 5000.0, 5012.0, 5020.0, 5023.0, 5031.0, 5060.925, 5079.0, 5082.0, 5121.0, 5146.0, 5150.0, 5181.990000000001, 5188.0, 5199.0, 5202.0, 5203.0, 5226.0, 5227.0, 5227.2, 5227.2, 5227.2, 5235.0, 5240.0, 5245.0, 5255.0, 5257.0, 5278.0, 5280.0, 5284.0, 5289.0, 5290.0, 5295.0, 5295.888, 5299.0, 5320.0, 5328.0, 5328.0, 5333.0, 5342.744000000001, 5360.0, 5372.0, 5373.0, 5390.0, 5401.0, 5412.0, 5418.0, 5441.0, 5443.0, 5447.0, 5450.0, 5484.0, 5487.0, 5488.0, 5488.0, 5491.0, 5496.0, 5504.0, 5512.0, 5512.0, 5523.0, 5524.0, 5555.0, 5566.0, 5632.0, 5647.0, 5650.0, 5657.0, 5662.8, 5662.8, 5663.0, 5679.0, 5680.0, 5691.0, 5692.0, 5712.0, 5719.0, 5723.0, 5740.0, 5750.0, 5760.0, 5765.0, 5767.73, 5773.0, 5785.0, 5785.0, 5794.28, 5835.0, 5839.0, 5845.0, 5874.0, 5875.0, 5894.0, 5920.0, 5924.0, 5953.0, 5961.0, 5984.0, 5990.0, 5993.0, 5996.0, 5999.0, 6000.0, 6000.0, 6023.0, 6032.0, 6040.0, 6047.0, 6050.0, 6050.0, 6050.0, 6072.0, 6094.0, 6095.0, 6098.0, 6098.400000000001, 6098.400000000001, 6098.400000000001, 6098.400000000001, 6098.400000000001, 6116.0, 6116.0, 6120.0, 6120.0, 6130.0, 6144.0, 6153.0, 6174.0, 6177.0, 6194.0, 6200.0, 6204.0, 6211.0, 6214.0, 6214.0, 6222.0, 6239.0, 6240.0, 6241.0, 6242.0, 6242.0, 6243.0, 6243.0, 6243.0, 6244.0, 6244.0, 6245.0, 6246.0, 6247.0, 6248.0, 6250.0, 6250.0, 6250.0, 6250.0, 6250.0, 6250.0, 6250.0, 6250.0, 6251.0, 6253.0, 6254.0, 6255.0, 6257.0, 6257.69, 6276.0, 6295.0, 6299.0, 6304.0, 6324.0, 6337.639999999999, 6344.0, 6345.0, 6382.0, 6386.0, 6400.0, 6416.0, 6416.0, 6435.0, 6439.0, 6440.0, 6446.0, 6498.0, 6500.0, 6500.0, 6500.0, 6503.0, 6513.0, 6528.0, 6534.0, 6534.0, 6534.0, 6534.0, 6534.0, 6534.0, 6534.0, 6534.0, 6534.0, 6534.0, 6555.0, 6580.86, 6600.0, 6669.0, 6669.83, 6687.0, 6699.0, 6702.0, 6705.0, 6720.0, 6730.0, 6750.0, 6750.0, 6810.0, 6817.0, 6818.0, 6855.0, 6932.0, 6956.0, 6966.0, 6969.0, 6969.6, 6969.6, 6969.6, 6969.6, 6969.6, 6969.6, 6969.6, 6986.0, 6991.0, 6993.8, 7060.0, 7075.0, 7141.0, 7198.0, 7205.0, 7250.0, 7306.1179999999995, 7310.0, 7312.0, 7381.02, 7405.200000000001, 7405.200000000001, 7405.200000000001, 7405.200000000001, 7405.200000000001, 7405.200000000001, 7405.200000000001, 7436.9, 7500.0, 7523.0, 7524.0, 7532.0, 7533.0, 7680.0, 7750.0, 7771.0, 7800.0, 7800.0, 7825.09, 7840.799999999999, 7840.799999999999, 7840.799999999999, 7840.799999999999, 7950.0, 7961.0, 8060.0, 8073.0, 8125.0, 8160.0, 8225.0, 8233.0, 8276.4, 8300.0, 8307.73, 8313.0, 8314.0, 8322.0, 8394.0, 8395.0, 8571.0, 8585.0, 8643.0, 8742.0, 8760.0, 8783.0, 8870.0, 9127.0, 9128.0, 9147.6, 9147.6, 9147.6, 9256.0, 9383.0, 9583.0, 9627.0, 9689.0, 9744.0, 10245.0, 10261.0, 10454.4, 10454.4, 10454.4, 10484.0, 10714.0, 10745.0, 10936.0, 10937.0, 11093.0, 11320.0, 11325.6, 11761.2, 11834.0, 12030.0, 12036.0, 12598.0, 12632.4, 12632.4, 13152.0, 13500.0, 14686.0, 14840.0, 15375.0, 16988.4, 17424.0, 18326.0, 18480.0, 19602.0, 20037.600000000002, 20250.0, 20473.199999999997, 21003.0, 22215.600000000002, 22215.600000000002, 22651.2, 22651.2, 23958.000000000004, 23958.000000000004, 24308.0, 27878.4, 27965.0, 31220.0, 33509.0, 33750.0, 35283.600000000006, 43560.0, 47916.00000000001, 47916.00000000001, 47916.00000000001, 53143.2, 53578.799999999996, 56628.0, 60548.399999999994, 62431.0, 64904.4, 67518.0, 80860.5, 87120.0, 87120.0, 87120.0, 107593.20000000001, 107593.20000000001, 107593.20000000001, 107593.20000000001, 107593.20000000001, 107593.20000000001, 109335.59999999999, 125452.79999999999, 149846.4, 167706.0, 189921.6, 209088.0, 209088.0, 213444.00000000003, 215622.0, 306662.4, 325393.2, 328442.4, 490050.0, 642510.0, 1145628.0, 1145628.0, 1406552.4, 1516323.6, 1623481.2000000002, 1739786.4, 2112224.4, 3003462.0, 3388968.0, 3484800.0, 3486978.0, 4212687.6, 5819180.4, 6119744.4, 6165918.000000001, 6542711.999999999, 7000963.2, 13495323.6, 17209249.2, 95439960.0], "city_averages": {"Prince Albert": 316347.1712328767, "Regina": 398114.23856858845, "Saskatoon": 570480.9363817098}, "r_squared": 0.1761, "adj_r_squared": 0.166, "n_listings": 1152};

const NUMERIC = [
  ['bedrooms',           'Beds'],
  ['bathrooms',          'Baths'],
  ['size_interior_sqft', 'Sqft'],
  ['lot_size_sqft',      'Lot sqft'],
  ['year_built',         'Year'],
  ['parking_spaces',     'Parking'],
];

const FLAGS = [
  ['is_house',           'House'],
  ['is_condo',           'Condo'],
  ['has_garage',         'Garage'],
  ['has_basement',       'Basement'],
  ['basement_finished',  'Fin. bsmt'],
  ['has_cooling',        'Cooling'],
];

function init() {
  document.getElementById('stats').textContent =
    `R\u00B2=${M.r_squared.toFixed(3)}  adj=${M.adj_r_squared.toFixed(3)}  n=${M.n_listings}`;

  const numGrid = document.getElementById('numeric-fields');
  for (const [name, label] of NUMERIC) {
    const ph = Math.round(M.feature_means[name]);
    let extra = '';
    if (name === 'year_built') extra = 'min="1850" max="2026"';
    else if (name === 'bedrooms' || name === 'bathrooms') extra = 'min="0" max="6"';
    else if (name === 'parking_spaces') extra = 'min="0" max="3"';
    else if (name === 'size_interior_sqft') extra = 'min="100" max="5000"';
    else if (name === 'lot_size_sqft') extra = 'min="0" max="15000"';
    numGrid.innerHTML += `
      <div>
        <label for="${name}" class="block text-xs text-neutral-400 mb-1">${label}</label>
        <input type="number" id="${name}" step="any" placeholder="${ph}" ${extra}
               oninput="if(this.max && parseFloat(this.value) > parseFloat(this.max)) this.value = this.max;"
               class="w-full border border-neutral-300 bg-white rounded px-2.5 py-1.5 text-sm font-mono tabular-nums placeholder:text-neutral-300 focus:outline-none focus:border-neutral-900 transition-colors">
      </div>`;
  }

  const flagGrid = document.getElementById('flag-fields');
  for (const [name, label] of FLAGS) {
    flagGrid.innerHTML += `
      <label class="flex items-center gap-1.5 cursor-pointer select-none">
        <input type="checkbox" id="${name}" class="accent-neutral-900 w-3.5 h-3.5">
        <span class="text-sm text-neutral-600">${label}</span>
      </label>`;
  }

  document.querySelectorAll('input[type="number"], input[type="checkbox"]').forEach(el => el.addEventListener('input', predict));
  document.querySelectorAll('input[name="city"]').forEach(el => el.addEventListener('change', predict));
}

function predict() {
  const nums = NUMERIC.map(([name]) => {
    const v = document.getElementById(name).value;
    let val = v === '' ? M.feature_means[name] : parseFloat(v);
    if (name === 'lot_size_sqft') {
      let idx = 0;
      while (idx < M.lot_sqfts_sorted.length && M.lot_sqfts_sorted[idx] < val) idx++;
      val = M.lot_sqfts_sorted.length > 0 ? (idx / M.lot_sqfts_sorted.length) * 100 : 50.0;
    }
    return val;
  });
  const flags = FLAGS.map(([name]) => document.getElementById(name).checked ? 1 : 0);
  const base = nums.concat(flags);

  const poly = M.powers.map(row => {
    let term = 1;
    for (let j = 0; j < row.length; j++) {
      if (row[j] === 1) term *= base[j];
      else if (row[j] === 2) term *= base[j] * base[j];
    }
    return term;
  });

  const city = document.querySelector('input[name="city"]:checked').value;
  const cityVec = [city === 'Saskatoon' ? 1 : 0, city === 'Regina' ? 1 : 0];
  const features = poly.concat(cityVec);

  let p = M.intercept;
  for (let i = 0; i < features.length; i++) p += M.coefficients[i] * features[i];

  p = Math.max(p, 0);

  const fmt = n => n.toLocaleString('en-CA', { maximumFractionDigits: 0 });
  const avg = M.city_averages[city];
  const delta = p - avg;
  const sign = delta >= 0 ? '+' : '';
  const color = delta >= 0 ? 'text-emerald-600' : 'text-red-500';

  document.getElementById('price').textContent = '$' + fmt(p);
  document.getElementById('context').innerHTML =
    `${city} avg $${fmt(avg)}&ensp;/&ensp;<span class="${color}">${sign}${fmt(delta)}</span>`;
  document.getElementById('result').classList.remove('hidden');
}

init();
predict();
</script>

</body>
</html>
